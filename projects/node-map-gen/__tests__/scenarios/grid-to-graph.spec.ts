import { createRNG } from '@src/create-rng';
import { Grid } from '@src/grid';
import { createGraph, MapNode } from '@src/map-graph';
import { renderGraph } from '@src/render-graph';
import { renderGrid } from '@src/render-grid';

describe('grid to graph', () => {
  let grid: Grid;
  test('create a grid', () => {
    grid = Grid.CREATE({
      width: 10,
      height: 30,
      roomCount: 50,
      rng: createRNG(12345),
    });
    expect(grid).toBeDefined();
    expect(renderGrid(grid)).toMatchInlineSnapshot(`
      "+---------+-------------------+--------------+----+
      |  5    5 | 24   24   24   24 | 23   23   23 | 26 |
      |         +---------+    +----+         +----+    |
      |  5    5 | 39   39 | 24 | 23   23   23 | 26   26 |
      |         +----+    +----+    +----+----+         |
      |  5    5 | 49 | 39 | 19 | 23 | 19 | 26   26   26 |
      +----+    |    +----+    +----+    +--------------+
      |  6 |  5 | 49 | 19   19   19   19 |  3    3    3 |
      |    +----+    |    +--------------+              |
      |  6 | 49   49 | 19 |  4    4    4 |  3    3    3 |
      |    |         +----+              |              |
      |  6 | 49   49 |  4    4    4    4 |  3    3    3 |
      |    +---------+----+    +----+    +----+         |
      |  6    6    6 | 46 |  4 | 17 |  4    4 |  3    3 |
      +----+---------+    +----+    +---------+---------+
      | 25 | 28   28 | 46   46 | 17   17   17 | 27   27 |
      |    |    +----+    +----+         +----+         |
      | 25 | 28 | 46   46 |  2 | 17   17 | 27   27   27 |
      |    |    +----+----+    |         +----+         |
      | 25 | 28 | 45 |  2    2 | 17   17   17 | 27   27 |
      +----+----+    +----+    |         +----+         |
      | 48   48 | 45   45 |  2 | 17   17 | 27   27   27 |
      |         |         |    |    +----+    +---------+
      | 48   48 | 45   45 |  2 | 17 | 35 | 27 | 44   44 |
      |         |         |    +----+    +----+         |
      | 48   48 | 45   45 |  2    2 | 35 | 44   44   44 |
      |    +----+---------+----+    |    +----+    +----+
      | 48 | 13   13   13 |  9 |  2 | 35   35 | 44 | 31 |
      +----+         +----+    +----+         +----+    |
      | 13   13   13 |  9    9 | 35   35   35   35 | 31 |
      |    +---------+         +---------+---------+    |
      | 13 |  9    9    9    9 |  8    8 | 40   40 | 31 |
      |    +----+---------+----+         |    +----+    |
      | 13 | 10 | 47   47 |  8    8    8 | 40 | 31   31 |
      +----+    +----+    +---------+----+----+----+----+
      | 10   10   10 | 47   47   47 | 30   30   30 | 38 |
      +----+         +---------+----+--------------+    |
      | 37 | 10   10 | 18   18 | 42 | 14   14   14 | 38 |
      |    |         +----+    |    +----+---------+    |
      | 37 | 10   10 | 16 | 18 | 42   42 | 41   41 | 38 |
      |    +---------+    |    |         +----+    +----+
      | 37 | 16   16   16 | 18 | 42   42 | 32 | 41 | 20 |
      |    |              |    +----+----+    +----+    |
      | 37 | 16   16   16 | 18   18 | 32   32 | 29 | 20 |
      |    +--------------+----+----+         |    |    |
      | 37 | 34   34   34   34 | 32   32   32 | 29 | 20 |
      |    |    +--------------+--------------+----+----+
      | 37 | 34 |  7    7    7 | 43   43   43   43   43 |
      |    +----+         +----+---------+--------------+
      | 37 |  7    7    7 | 36 |  1    1 | 21   21   21 |
      +----+--------------+    |         +----+         |
      | 36   36   36   36   36 |  1    1 | 22 | 21   21 |
      |    +-------------------+         |    +---------+
      | 36 | 15   15   15   15 |  1    1 | 22   22   22 |
      +----+              +----+---------+----+---------+
      | 33 | 15   15   15 | 11   11   11 | 12 |  0    0 |
      |    +---------+    |         +----+    |         |
      | 33   33   33 | 15 | 11   11 | 12   12 |  0    0 |
      |              +----+         |         |         |
      | 33   33   33   33 | 11   11 | 12   12 |  0    0 |
      +-------------------+---------+---------+---------+

      room 0 size=6 cells=278,279,288,289,298,299
      room 1 size=6 cells=245,246,255,256,265,266
      room 2 size=8 cells=84,93,94,104,114,124,125,135
      room 3 size=11 cells=37,38,39,47,48,49,57,58,59,68,69
      room 4 size=10 cells=44,45,46,53,54,55,56,64,66,67
      room 5 size=7 cells=0,1,10,11,20,21,31
      room 6 size=6 cells=30,40,50,60,61,62
      room 7 size=6 cells=232,233,234,241,242,243
      room 8 size=5 cells=155,156,164,165,166
      room 9 size=7 cells=134,143,144,151,152,153,154
      room 10 size=8 cells=161,170,171,172,181,182,191,192
      room 11 size=7 cells=274,275,276,284,285,294,295
      room 12 size=5 cells=277,286,287,296,297
      room 13 size=8 cells=131,132,133,140,141,142,150,160
      room 14 size=3 cells=186,187,188
      room 15 size=8 cells=261,262,263,264,271,272,273,283
      room 16 size=7 cells=193,201,202,203,211,212,213
      room 17 size=12 cells=65,75,76,77,85,86,95,96,97,105,106,115
      room 18 size=6 cells=183,184,194,204,214,215
      room 19 size=7 cells=24,26,33,34,35,36,43
      room 20 size=3 cells=209,219,229
      room 21 size=5 cells=247,248,249,258,259
      room 22 size=4 cells=257,267,268,269
      room 23 size=7 cells=6,7,8,15,16,17,25
      room 24 size=5 cells=2,3,4,5,14
      room 25 size=3 cells=70,80,90
      room 26 size=6 cells=9,18,19,27,28,29
      room 27 size=11 cells=78,79,87,88,89,98,99,107,108,109,117
      room 28 size=4 cells=71,72,81,91
      room 29 size=2 cells=218,228
      room 30 size=3 cells=176,177,178
      room 31 size=5 cells=139,149,159,168,169
      room 32 size=6 cells=207,216,217,225,226,227
      room 33 size=8 cells=270,280,281,282,290,291,292,293
      room 34 size=5 cells=221,222,223,224,231
      room 35 size=8 cells=116,126,136,137,145,146,147,148
      room 36 size=7 cells=244,250,251,252,253,254,260
      room 37 size=7 cells=180,190,200,210,220,230,240
      room 38 size=3 cells=179,189,199
      room 39 size=3 cells=12,13,23
      room 40 size=3 cells=157,158,167
      room 41 size=3 cells=197,198,208
      room 42 size=5 cells=185,195,196,205,206
      room 43 size=5 cells=235,236,237,238,239
      room 44 size=6 cells=118,119,127,128,129,138
      room 45 size=7 cells=92,102,103,112,113,122,123
      room 46 size=5 cells=63,73,74,82,83
      room 47 size=5 cells=162,163,173,174,175
      room 48 size=7 cells=100,101,110,111,120,121,130
      room 49 size=6 cells=22,32,41,42,51,52"
    `);
  });

  let graph: MapNode;
  test('create a graph', () => {
    graph = createGraph(grid);
    expect(graph).toBeDefined();
    expect(renderGraph(graph)).toMatchInlineSnapshot(`
      "<root> node 22
        (22) ->  node 0
          (0) ->  node 12
            (12) ->  node 11
              (11) ->  node 15
                (15) ->  node 36
                  (36) ->  node 7
                    (7) ->  node 34
                      (34) ->  node 32
                        (32) ->  node 43
                          (43) ->  node 21

                          (43) ->  node 20
                            (20) ->  node 41
                              (41) ->  node 14
                                (14) ->  node 30
                                  (30) ->  node 31
                                    (31) ->  node 44
                                      (44) ->  node 27
                                        (27) ->  node 17
                                          (17) ->  node 2
                                            (2) ->  node 9
                                              (9) ->  node 10
                                                (10) ->  node 13
                                                  (13) ->  node 48
                                                    (48) ->  node 28
                                                      (28) ->  node 6
                                                        (6) ->  node 49
                                                          (49) ->  node 4
                                                            (4) ->  node 3
                                                              (3) ->  node 26
                                                                (26) ->  node 23
                                                                  (23) ->  node 24

                                                          (49) ->  node 19

                                                          (49) ->  node 39

                                                        (6) ->  node 5

                                                      (28) ->  node 46

                                                    (48) ->  node 25

                                              (9) ->  node 8

                                            (2) ->  node 45

                                    (31) ->  node 35

                                  (30) ->  node 47

                                  (30) ->  node 40

                                (14) ->  node 42

                            (20) ->  node 38

                        (32) ->  node 29

                        (32) ->  node 18

                      (34) ->  node 16

                      (34) ->  node 37

                  (36) ->  node 1

                  (36) ->  node 33
      "
    `);
  });
});
